version: '2'
services:
    musl:
      image: untangleinc/discoverd:build-musl
      volumes:
        - ..:/go/discoverd

    glibc:
      image: untangleinc/discoverd:build-glibc
      volumes:
        - ..:/go/discoverd

    # the next 2 services allow for local changes and tests to the
    # docker images, before pushing new official ones to GitHub: the
    # build images are being built locally

    musl-local:
      build:
        context: .
        dockerfile: Dockerfile.build-musl
      working_dir: /app
      environment:
        SSH_AUTH_SOCK: /ssh-agent
      volumes:
        - ..:/app
        - ${SSH_AUTH_SOCK}:/ssh-agent
        - go_cache:/go
      #command: tail -f /dev/null

    glibc-local:
      build:
        context: .
        dockerfile: Dockerfile.build-glibc
      working_dir: /app
      environment:
        SSH_AUTH_SOCK: /ssh-agent
      volumes:
        - ..:/app
        - ${SSH_AUTH_SOCK}:/ssh-agent
        - go_cache:/go

volumes: 
  go_cache: